<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AxyMusic</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework"></script>
</head>
<body>
<!-- Hidden placeholders to prevent JS errors (unchanged) -->
<button id="play-button" style="display:none" aria-hidden="true"></button>
<button id="repeat-button" style="display:none" aria-hidden="true"></button>

<header>
  <h1>🟣AxyMusic🟣Free Music🟣No Adds🟣24/7🟣</h1>
  <nav>
    <ul class="nav-links">
      <li><a href="https://contactme-zeta.vercel.app" class="btn">🟣Contact Axy🟣</a></li>
      <li><a href="https://www.paypal.com/paypalme/iamaxy" class="btn">💜Coffee💜</a></li>
      <li>
        <a href="liked.html" class="btn" id="liked-link">
          ♥ Liked <span id="liked-count" class="badge">0</span>
        </a>
      </li>
    </ul>
  </nav>
</header>

<!-- ===== Artists quick access ===== -->
<div class="section-divider" aria-hidden="true"></div>
<section class="artists-section" aria-label="Artists">
  <h2>Artists</h2>
  <div class="artist-buttons">
    <button class="artist-btn" data-artist="lilpeep">Lil Peep</button>
    <button class="artist-btn" data-artist="liltjay">Lil Tjay</button>
    <button class="artist-btn" data-artist="juicewrld">Juice WRLD</button>
    <button class="artist-btn" data-artist="xxxtentacion">XXXTentacion</button>
  </div>
</section>

<!-- Player panel (kept, hidden by CSS for logic only) -->
<div id="player-panel">
  <img id="player-image" class="cover" src="" alt="Cover Art" />
  <div id="player-info">
    <p id="player-name">No song playing</p>
    <p id="player-album">Select a song...</p>
    <audio id="player" controls controlsList="download" x-webkit-airplay="allow" playsinline>
      <source id="audioSource" src="">
    </audio>
  </div>
</div>

<section class="controls">
  <button id="prev-button" class="control-btn">⏮</button>
  <button id="next-button" class="control-btn">⏭</button>
</section>

<form id="search-form" class="search-form">
  <input id="saavn-search-box" type="search" placeholder="search for any song here!">
  <!-- CHANGED: type=submit so the form listener in functions.js runs -->
  <button id="saavn-search-trigger" class="btn" type="submit">🔎search🔍</button>
</form>

<div id="saavn-results" class="results-wrapper"></div>

<button id="load-more" class="btn load-more-btn">Load More Songs</button>
<button id="loadmore" style="display:none" aria-hidden="true"></button>

<script src="functions.js"></script>
<script src="saavn-search.js"></script>

<!-- ===== Unified bottom deck (seek ABOVE meta, centered) ===== -->
<div id="floating-deck" role="region" aria-label="Now playing controls">
  <!-- Top: seek row -->
  <div id="deck-seek">
    <div id="seek-tray" aria-hidden="true"></div>
    <input id="bar-seek" type="range" min="0" max="100" value="0" step="0.1" aria-label="Seek">
  </div>

  <div class="deck-divider" aria-hidden="true"></div>

  <!-- Middle: metadata -->
  <div id="floating-meta">
    <img id="bar-cover" class="bar-cover" alt="">
    <div class="bar-meta">
      <div id="bar-title" class="bar-title">Nothing playing</div>
      <div id="bar-artist" class="bar-artist"></div>
    </div>
  </div>

  <div class="deck-divider" aria-hidden="true"></div>

  <!-- Bottom: controls -->
  <div id="floating-soundbar">
    <div class="bar-controls">
      <button id="float-prev" aria-label="Previous">⏮</button>
      <button id="float-play" aria-label="Play/Pause">▶️</button>
      <button id="float-next" aria-label="Next">⏭</button>
    </div>

    <div class="bar-actions">
      <button id="shuffle-button" class="control-btn" title="Shuffle">🔀</button>
      <button id="bar-like" title="Like">♡</button>
      <select id="sleep-timer" aria-label="Sleep timer">
        <option value="">⏲Sleep</option>
        <option value="900">15m</option>
        <option value="1800">30m</option>
        <option value="2700">45m</option>
        <option value="3600">1h</option>
      </select>
      <button id="cast-button" aria-label="Cast to TV" style="display:none">Google Cast📡</button>
      <button id="airplay-button" aria-label="Air Play" style="display:none">Air Play📺</button>
    </div>
  </div>
</div>

<footer>2025 Saavn Media Limited All rights reserved
  <li><a href="https://wiz64.com/sponsor" class="btn">🖤Special Thanks to wiz64🖤</a></li>
  <li><a href="https://contactme-zeta.vercel.app" class="btn">💜Made By Axy💜</a></li>
</footer>

<!-- Helpers: purple seek fill + artist button wiring -->
<script>
(function() {
  // Artist quick-search: prefer your form submit (functions.js), else use legacy doSaavnSearch
  function renderArtist(artist) {
    const box  = document.getElementById('saavn-search-box');
    const form = document.getElementById('search-form');
    if (!box) return;
    box.value = artist;

    // Prefer the submit listener in functions.js (renderResults on submit) :contentReference[oaicite:2]{index=2}
    if (form && typeof form.requestSubmit === 'function') {
      form.requestSubmit();
    } else if (typeof window.doSaavnSearch === 'function') {
      // Fallback to legacy engine in saavn-search.js :contentReference[oaicite:3]{index=3}
      window.doSaavnSearch(encodeURIComponent(artist));
    }

    document.getElementById('saavn-results')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.artist-btn').forEach(b => {
      b.addEventListener('click', () => renderArtist(b.dataset.artist));
    });
  });

  // Deck wiring (seek cosmetic only)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFloatingDeck);
  } else {
    initFloatingDeck();
  }
  function initFloatingDeck() {
    const audio = document.getElementById('player');
    const playBtn = document.getElementById('float-play');
    const prevBtn = document.getElementById('float-prev');
    const nextBtn = document.getElementById('float-next');
    const seek = document.getElementById('bar-seek');
    const sleepTimer = document.getElementById('sleep-timer');
    const airplayBtn = document.getElementById('airplay-button');
    const castBtn = document.getElementById('cast-button');

    let sleepTimeout = null;
    const updatePlayButton = () => {
      playBtn.textContent = audio.paused ? '▶️' : '⏸';
      playBtn.setAttribute('aria-pressed', audio.paused ? 'false' : 'true');
    };
    playBtn.addEventListener('click', () => { if (audio.paused) audio.play(); else audio.pause(); updatePlayButton(); });
    prevBtn.addEventListener('click', () => document.getElementById('prev-button')?.click());
    nextBtn.addEventListener('click', () => document.getElementById('next-button')?.click());
    audio.addEventListener('play', updatePlayButton);
    audio.addEventListener('pause', updatePlayButton);
    updatePlayButton();

    function setSeekBG() {
      const pct = (seek.valueAsNumber || 0);
      seek.style.background = `linear-gradient(var(--dark-purple),var(--dark-purple)) 0/ ${pct}% 100% no-repeat, var(--seek-track)`;
    }
    audio.addEventListener('timeupdate', () => {
      if (isFinite(audio.duration)) {
        seek.value = (audio.currentTime / audio.duration) * 100 || 0;
        setSeekBG();
      }
    });
    seek.addEventListener('input', () => {
      if (isFinite(audio.duration)) audio.currentTime = (seek.value / 100) * audio.duration;
      setSeekBG();
    });
    setSeekBG();

    sleepTimer.addEventListener('change', () => {
      if (sleepTimeout) clearTimeout(sleepTimeout);
      const s = parseInt(sleepTimer.value, 10);
      if (s) sleepTimeout = setTimeout(() => { audio.pause(); sleepTimer.value=''; updatePlayButton(); }, s*1000);
    });

    if (window.WebKitPlaybackTargetAvailabilityEvent || audio.webkitShowPlaybackTargetPicker) {
      airplayBtn.style.display = 'inline-block';
      airplayBtn.addEventListener('click', () => audio.webkitShowPlaybackTargetPicker?.());
    }
    window.__onGCastApiAvailable = function(isAvailable) {
      if (!isAvailable) return;
      castBtn.style.display = 'inline-block';
    };
  }
})();
</script>
</body>
</html>
